<!DOCTYPE html>
<html>
<head>
    <title>Control Panel</title>
    <style>
        .grid-container {
            display: grid;
            grid-template-columns: auto auto;
            padding: 10px;
        }
        .grid-item {
            padding: 20px;
            text-align: center;
            border: 1px solid black;
            margin: 10px;
        }
        .status-light {
            height: 15px;
            width: 15px;
            border-radius: 50%;
            display: inline-block;
        }
        .red {
            background-color: red;
        }
        .blue {
            background-color: blue;
        }
    </style>
</head>
<body>
    <div class="grid-container">
    {% for action in actions %}
        <div class="grid-item">
            <span id="{{ action }}_statusLight" class="status-light red"></span> <!-- Change class to 'blue' for running status -->
            <h3>{{ action }}</h3>
            <button onclick="start('{{ action }}')">Start</button>
            <button onclick="stop('{{ action }}')">Stop</button>
        </div>
    {% endfor %}
    </div>

    <script>
    function start(action) {
        fetch(`/start/${action}`, { method: 'GET' })
            .then(response => response.json())
            .then(response => {
                console.log(response);
                checkStatusAndUpdateLight(action);
                })
            .catch(error => console.error('Error:', error));
    }

    function stop(action) {
        fetch(`/stop/${action}`, { method: 'GET' })
            .then(response => response.json())
            .then(response => {
                console.log(response);
                checkStatusAndUpdateLight(action);
                })
            .catch(error => console.error('Error:', error));
    }

    function checkStatusAndUpdateLight(action) {
        fetch(`/status/${action}`, { method: 'GET' })
            .then(res => res.json())
            .then(res => {
                console.log(res);
                const statusLight = document.getElementById(action + '_statusLight');
                if (res.running) {
                    statusLight.classList.remove('red');
                    statusLight.classList.add('blue');
                } else {
                    statusLight.classList.remove('blue');
                    statusLight.classList.add('red');
                }
            })
            .catch(error => console.error('Error:', error));
    }
    {% for action in actions %}
    setInterval(() => checkStatusAndUpdateLight('{{ action }}'), 5000);
    {% endfor %}

</script>
</body>
</html>
